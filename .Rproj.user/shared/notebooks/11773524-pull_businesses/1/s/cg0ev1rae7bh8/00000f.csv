"0","#### Yelp api call function ####"
"0","url <- ""https://api.yelp.com/v3/businesses/search"""
"0",""
"0","get_yelp = function(category, zip_code, offset_num) { # args are category of business, zipcode, and number to offset by"
"0","  "
"0","  queryString = list("
"0","    location = zip_code, # argument to be filled"
"0","    term = category, # argument to be filled"
"0","    sort_by = ""distance"", # sort by dist"
"0","    limit = 50, # 50 is the max for yelp fusion api, any higher and it won't work"
"0","    offset = offset_num # argument to be filled"
"0","  )"
"0","  "
"0","  # use ""GET"" verb to request information from url"
"0","  response <- VERB(""GET"", url, query = queryString, "
"0","                   add_headers('Authorization' = 'Bearer hVIEeA6P5U7zyjMISG5Z6XTxKr8o6HVjT58cs419ulWYT49b-5JPLpbJfwEzSLgHcKZUz4SlT7fBG5NaHoKX9MKe_PM02Tw4_dO-EEr4tHNIZkd04Y8HV4NVPjpJZXYx'), "
"0","                   content_type(""application/octet-stream""), "
"0","                   accept(""application/json""))"
"0","  "
"0","  # turn the response into a json file"
"0","  yelp.json = content(response, ""parsed"", flatten = TRUE, simplify = TRUE)"
"0","  "
"0","  # retrieve columns from json structure"
"0","  biz.name = data.frame(yelp.json$businesses$name)"
"0","  biz.lat = data.frame(yelp.json$businesses$coordinates.latitude)"
"0","  biz.lon = data.frame(yelp.json$businesses$coordinates.longitude)"
"0","  biz.rating = data.frame(yelp.json$businesses$rating)"
"0","  biz.addr = data.frame(yelp.json$businesses$location.address1)"
"0","  "
"0","  # bind the columns into one dataframe"
"0","  yelp.df = cbind(biz.name, biz.rating, biz.addr, biz.lat, biz.lon)  %>%"
"0","    as.data.frame()"
"0","  "
"0","  colnames(yelp.df) <- c(""name"", ""rating"", ""address"", ""lat"", ""lon"")"
"0","  "
"0","  # add in category alias/title (this will give us cuisine information)"
"0","  cuisine = yelp.json$businesses$categories"
"0","  "
"0","  cuis.df <- map_dfr(cuisine, function(x) {"
"0","    tibble("
"0","      alias = paste(x$alias, collapse = "", ""),"
"0","      title = paste(x$title, collapse = "", "")) %>%"
"0","      as.data.frame()"
"0","  })"
"0","  "
"0","  yelp.df <- yelp.df %>%"
"0","    cbind(cuis.df)"
"0","  "
"0","  # # Replace NA values with """""
"0","  # yelp.df <- yelp.df %>% "
"0","  #   mutate(across(everything(), ~replace_na(.x, """")))"
"0","  "
"0","  # When creating an empty dataframe, use """" as default value"
"0","  if(nrow(yelp.df) == 0) {"
"0","    yelp.df <- data.frame(name="""", rating=numeric(0), address="""", lat=numeric(0), lon=numeric(0), alias = """", title = """", stringsAsFactors=FALSE)"
"0","  }"
"0","  "
"0","  return(yelp.df)"
"0","}"
